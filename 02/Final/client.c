/*    CSE 344 Systems Programming    Final Project    client.c    Omer CEVIK    161044004*/#include "main.h"static void signalHandler(int signo){    if (signo == SIGINT)    {        write(STDOUT_FILENO, "\nCTRL-C is caught!\n", strlen("\nCTRL-C is caught!\n"));        exit(0);    }}void clientFunction(int sockfd, char* nodes){    char buff[MAX] = "";    int i = 0;    bzero(buff, sizeof(buff));    for (i = 0; i < strlen(nodes); ++i)        buff[i] = nodes[i];    buff[i] = '\0';    write(sockfd, buff, sizeof(buff));    bzero(buff, sizeof(buff));    read(sockfd, buff, sizeof(buff));    double seconds = 0.0;    read(sockfd, &seconds, sizeof(double));    if (buff[0] == '#')    {        clock_t t = clock();        sprintf(buff,"Timestamp(%ld) Server’s response (%d): NO PATH, arrived in %fseconds, shutting down\n",t, getpid(), seconds);        write(STDOUT_FILENO, buff, strlen(buff));    }    else    {        clock_t t = clock();        char str[4096] = "";        sprintf(str,"Timestamp(%ld) Server’s response to (%d): %s, arrived in %fseconds.\n",t, getpid(), buff, seconds);        write(STDOUT_FILENO, str, strlen(str));    }}int main(int argc, char *argv[]){    char str[1024] = "";    if (argc != 9)    {        sprintf(str,"Error:\tUsage: ./client -a 127.0.0.1 -p PORT -s 768 -d 979");        write(STDERR_FILENO, str, strlen(str));        exit(EXIT_FAILURE);    }    struct sigaction act;    memset (&act,0 , sizeof(act));    act.sa_flags = 0;    act.sa_handler = &signalHandler;    if (sigaction(SIGINT, &act, NULL) < 0)    {        sprintf(str,"Error: Sigaction SIGINT!");        write(STDERR_FILENO, str, strlen(str));        exit(EXIT_FAILURE);    }    char *IPAddress = NULL;    int portNumber = 0, nodeStart = 0, nodeEnd = 0;    getArgumentsClient(argc, argv, &IPAddress, &portNumber, &nodeStart, &nodeEnd);    int sockfd = 0;    struct sockaddr_in servaddr;    sockfd = socket(AF_INET, SOCK_STREAM, 0);    if (sockfd == -1)    {        sprintf(str,"Error: Socket creation failed!\n");        write(STDERR_FILENO,str,strlen(str));        exit(EXIT_FAILURE);    }    clock_t t = clock();    sprintf(str,"Timestamp(%ld) Client (%d) connecting to %s:%d\n",t, getpid(), IPAddress, portNumber);    write(STDOUT_FILENO,str,strlen(str));    bzero(&servaddr, sizeof(servaddr));    servaddr.sin_family = AF_INET;    servaddr.sin_addr.s_addr = inet_addr(IPAddress);    servaddr.sin_port = htons(portNumber);    if (connect(sockfd, (SA*)&servaddr, sizeof(servaddr)) != 0)    {        sprintf(str,"Error: Connection with the server failed!\n");        write(STDERR_FILENO,str,strlen(str));        exit(EXIT_FAILURE);    }    t = clock();    sprintf(str,"Timestamp(%ld) Client (%d) connected and requesting a path from node %d to %d\n",t, getpid(), nodeStart, nodeEnd);    write(STDOUT_FILENO,str,strlen(str));    sprintf(str,"%d %d",nodeStart,nodeEnd);    clientFunction(sockfd,str);    close(sockfd);    return 0;}void getArgumentsClient(int argc, char *argv[], char** IPAddress, int* portNumber, int* nodeStart, int* nodeEnd){    int opt = 0;    while((opt = getopt(argc, argv, "a:p:s:d:")) != -1)    {        switch(opt)        {            case 'a':                *IPAddress = optarg;                break;            case 'p':                sscanf(optarg,"%d",portNumber);                break;            case 's':                sscanf(optarg,"%d",nodeStart);                break;            case 'd':                sscanf(optarg,"%d",nodeEnd);                break;            default:                perror("Unknown option!\n");                exit(EXIT_FAILURE);                break;        }    }}