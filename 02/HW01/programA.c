/*    CSE 344 Systems Programming    Homework 01    programA.c    Omer CEVIK    161044004*/#include <stdio.h>#include <unistd.h>#include <errno.h>#include <fcntl.h>#include <stdlib.h>#include <string.h>void getArguments(int argc, char *argv[], char** inputPathA, char** outputPathA, int* time);void fileOperations(char* inputPathA, char* outputPathA, int time);int main(int argc, char *argv[]){    if (argc != 7)    {        perror("Error:\tUsage: ./programA -i inputPathA -o outputPathA -t time");        return 1;    }    char* inputPathA = NULL;    char* outputPathA = NULL;    int time = 0;    getArguments(argc, argv, &inputPathA, &outputPathA, &time);    fileOperations(inputPathA, outputPathA, time);    return 0;}void getArguments(int argc, char *argv[], char** inputPathA, char** outputPathA, int* time){    int opt = 0;    while((opt = getopt(argc, argv, "i:o:t:")) != -1)    {        switch(opt)        {            case 'i':                *inputPathA = optarg;                break;            case 'o':                *outputPathA = optarg;                break;            case 't':                sscanf(optarg,"%d",time);                break;            default:                perror("Unknown option!\n");                break;        }    }}void fileOperations(char* inputPathA, char* outputPathA, int time){    int fdInput = open(inputPathA, O_RDONLY);    int fdOutput = open(outputPathA, O_WRONLY | O_CREAT | O_APPEND);    if (fdInput == -1)    {        printf("Error Number %d\n", errno);        perror("Program can not open input file!");        exit(1);    }    if (fdOutput == -1)    {        printf("Error Number %d\n", errno);        perror("Program can not open output file!");        exit(1);    }    if (1 > time || time > 50)    {        perror("Time is out of bounds!");        exit(1);    }    struct flock mutex;    memset(&mutex, 0, sizeof(struct flock));    while(1)    {        mutex.l_type = F_WRLCK;        if (fcntl(fdOutput, F_SETLKW, &mutex) == 0)        {            char readInput[32] = "";            int readRes = 0;            while( (readRes = read(fdInput, readInput, 32)) == 32 )            {                int i = 0, j = 0;                for (i = 0; i < 16; ++i, j += 2)                {                    int real = (int)readInput[j];                    int img = (int)readInput[j+1];                    char out[15];                    sprintf(out,"%d +i%d,",real, img);                    write(fdOutput, out, strlen(out));                }                write(fdOutput, "\n", sizeof(char));                mutex.l_type = F_UNLCK;                fcntl(fdOutput, F_SETLKW, &mutex);                sleep(time/1000.0);            }            break;        }    }    close(fdInput);    close(fdOutput);}